from skimage import data, io, filters, exposure,img_as_ubyte
from skimage.color import rgb2gray
from skimage.feature import blob_dog, blob_log, blob_doh
from matplotlib import pyplot as plt
from math import sqrt
from skimage.morphology import disk
from skimage.filters.rank import median
import os,sys 
import utils

def load_image(filename):
    img = io.imread(filename)
    return img

def main(argv):
    try:
        if len(argv) < 1:
            print("too few arguments")
        #rootFolder = "./test/"
        #os.mkdir(rootFolder)
        images = []
        delta = []
        for filename in os.listdir(argv[1]):
            suffix = os.path.splitext(filename)[1][1:]
            print(suffix)
            if suffix !="jpg":
                continue 
            filename = os.path.join(argv[1],filename)
            img = load_image(filename)
            print(filename)
            #utils.preprocess(['',filename])
            images.append(utils.preprocess(['',filename])

        length = len(images)
        if length > 1:
            print(images[1])
            delta.append(images[1]- images[0])
            for row in delta[0]:
                for pixal in row:
                    if pixal < 0: 
                        pixal = 0
            io.imsave("delta0.jpg",delta[0])
        if length >2:
            delta.append(images[2]- images[1])
            for row in delta[1]:
                for pixal in row:
                    if pixal < 0: 
                        pixal = 0
            io.imsave("delta1.jpg",delta[1])
        if length >3:
            delta.append(images[3]- images[2])
            for row in delta[2]:
                for pixal in row:
                    if pixal < 0: 
                        pixal = 0
            io.imsave("delta2.jpg",delta[2])
    except IOError as ex:
        print("IO error %s" % ex.strerror)

if __name__ == "__main__":
    main(sys.argv)

